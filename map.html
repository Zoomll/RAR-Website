<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive SVG Map with Zoom and Pan</title>
    <style>
        #svgContainer {
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            border: 1px solid black;
            position: relative;
            touch-action: none; /* Disable default touch actions for smoother panning */
        }
        #svgImage {
            width: 100%;
            height: 100%;
        }
        #zoomValue {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 5px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <span id="zoomValue">1</span>
    <div id="svgContainer">
        <!-- Your SVG Map (The Robloxian Archipelago Map) -->
        <svg id="svgImage" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 2000 1000" preserveAspectRatio="xMidYMid meet">
            <image href="TheRobloxianArchipelagoMapV1.svg" width="2000" height="1000" />
        </svg>
    </div>

    <script>
        const svgImage = document.getElementById("svgImage");
        const svgContainer = document.getElementById("svgContainer");
        const zoomValue = document.getElementById("zoomValue");

        let viewBox = { x: 0, y: 0, w: svgImage.clientWidth, h: svgImage.clientHeight };
        svgImage.setAttribute('viewBox', `${viewBox.x} ${viewBox.y} ${viewBox.w} ${viewBox.h}`);
        const svgSize = { w: svgImage.clientWidth, h: svgImage.clientHeight };
        let isPanning = false;
        let startPoint = { x: 0, y: 0 };
        let scale = 1;

        // Mousewheel Zooming (fix zoom direction)
        svgContainer.onmousewheel = function (e) {
            e.preventDefault();
            let w = viewBox.w;
            let h = viewBox.h;
            let mx = e.offsetX; // mouse x
            let my = e.offsetY; // mouse y

            // Calculate zoom step
            let dw = -w * Math.sign(e.deltaY) * 0.05;
            let dh = -h * Math.sign(e.deltaY) * 0.05;

            // Calculate mouse positioning in relation to zoom
            let dx = (dw * mx) / svgSize.w;
            let dy = (dh * my) / svgSize.h;

            // Update the viewBox values
            viewBox = {
                x: viewBox.x + dx,
                y: viewBox.y + dy,
                w: viewBox.w - dw,
                h: viewBox.h - dh
            };
            
            // Update scale and set the new viewBox
            scale = svgSize.w / viewBox.w;
            svgImage.setAttribute('viewBox', `${viewBox.x} ${viewBox.y} ${viewBox.w} ${viewBox.h}`);
            zoomValue.innerText = `${Math.round(scale * 100) / 100}`;
        };

        // Mouse Dragging for Panning
        svgContainer.onmousedown = function (e) {
            isPanning = true;
            startPoint = { x: e.x, y: e.y };   
        };

        svgContainer.onmousemove = function (e) {
            if (isPanning) {
                let dx = (startPoint.x - e.x) / scale;
                let dy = (startPoint.y - e.y) / scale;

                // Update viewBox as we pan
                let movedViewBox = {
                    x: viewBox.x + dx,
                    y: viewBox.y + dy,
                    w: viewBox.w,
                    h: viewBox.h
                };

                svgImage.setAttribute('viewBox', `${movedViewBox.x} ${movedViewBox.y} ${movedViewBox.w} ${movedViewBox.h}`);
            }
        };

        svgContainer.onmouseup = function (e) {
            if (isPanning) {
                let dx = (startPoint.x - e.x) / scale;
                let dy = (startPoint.y - e.y) / scale;

                // Update the final position after panning
                viewBox = {
                    x: viewBox.x + dx,
                    y: viewBox.y + dy,
                    w: viewBox.w,
                    h: viewBox.h
                };

                svgImage.setAttribute('viewBox', `${viewBox.x} ${viewBox.y} ${viewBox.w} ${viewBox.h}`);
                isPanning = false;
            }
        };

        svgContainer.onmouseleave = function () {
            isPanning = false;
        };
    </script>
</body>
</html>
